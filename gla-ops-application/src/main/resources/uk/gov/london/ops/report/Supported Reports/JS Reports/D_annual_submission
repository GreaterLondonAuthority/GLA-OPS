select distinct   org.id org_id,   org.name org_name,  sub.financial_year sub_year,    (sub.financial_year) || '/' || (sub.financial_year + 1) financial_year ,   sub.status  ,  sub.approval_comments, sub.submission_comments, sub.rcgf_rollover, sub.dpf_rollover,          case when min0.financial_year    = sub.financial_year then 0 else  (case when min0.financial_year+1 = sub.financial_year then  coalesce(min1_RCGF_bal,0) else  (case when min0.financial_year+2 = sub.financial_year then  coalesce(min1_RCGF_bal,0) + coalesce(min2_RCGF_bal,0) else  (case when min0.financial_year+3 = sub.financial_year then  coalesce(min1_RCGF_bal,0) + coalesce(min2_RCGF_bal,0) + coalesce(min3_RCGF_bal,0) else  (case when min0.financial_year+4 = sub.financial_year then  coalesce(min1_RCGF_bal,0) + coalesce(min2_RCGF_bal,0) + coalesce(min3_RCGF_bal,0) + coalesce(min4_RCGF_bal,0) else  (case when min0.financial_year+5 = sub.financial_year then  coalesce(min1_RCGF_bal,0) + coalesce(min2_RCGF_bal,0) + coalesce(min3_RCGF_bal,0) + coalesce(min4_RCGF_bal,0) + coalesce(min5_RCGF_bal,0) else 0 end) end)  end) end) end) end opening_RCGF_balance,    case when min0.financial_year    = sub.financial_year then  coalesce(min1_RCGF_bal,0) else  (case when min0.financial_year+1 = sub.financial_year then  coalesce(min1_RCGF_bal,0) + coalesce(min2_RCGF_bal,0) else  (case when min0.financial_year+2 = sub.financial_year then  coalesce(min1_RCGF_bal,0) + coalesce(min2_RCGF_bal,0) + coalesce(min3_RCGF_bal,0) else  (case when min0.financial_year+3 = sub.financial_year then  coalesce(min1_RCGF_bal,0) + coalesce(min2_RCGF_bal,0) + coalesce(min3_RCGF_bal,0) + coalesce(min4_RCGF_bal,0) else  (case when min0.financial_year+4 = sub.financial_year then  coalesce(min1_RCGF_bal,0) + coalesce(min2_RCGF_bal,0) + coalesce(min3_RCGF_bal,0) + coalesce(min4_RCGF_bal,0) + coalesce(min5_RCGF_bal,0) else  (case when min0.financial_year+5 = sub.financial_year then  coalesce(min1_RCGF_bal,0) + coalesce(min2_RCGF_bal,0) + coalesce(min3_RCGF_bal,0) + coalesce(min4_RCGF_bal,0) + coalesce(min5_RCGF_bal,0) + coalesce(min6_RCGF_bal,0)  else 0 end) end)  end) end) end) end closing_RCGF_balance,   case when min0.financial_year    = sub.financial_year then 0 else  (case when min0.financial_year+1 = sub.financial_year then  coalesce(min1_DPF_bal,0) else  (case when min0.financial_year+2 = sub.financial_year then  coalesce(min1_DPF_bal,0) + coalesce(min2_DPF_bal,0) else  (case when min0.financial_year+3 = sub.financial_year then  coalesce(min1_DPF_bal,0) + coalesce(min2_DPF_bal,0) + coalesce(min3_DPF_bal,0) else  (case when min0.financial_year+4 = sub.financial_year then  coalesce(min1_DPF_bal,0) + coalesce(min2_DPF_bal,0) + coalesce(min3_DPF_bal,0) + coalesce(min4_DPF_bal,0) else  (case when min0.financial_year+5 = sub.financial_year then  coalesce(min1_DPF_bal,0) + coalesce(min2_DPF_bal,0) + coalesce(min3_DPF_bal,0) + coalesce(min4_DPF_bal,0) + coalesce(min5_DPF_bal,0) else 0 end) end)  end) end) end) end opening_DPF_balance,    case when min0.financial_year    = sub.financial_year then  coalesce(min1_DPF_bal,0) else  (case when min0.financial_year+1 = sub.financial_year then  coalesce(min1_DPF_bal,0) + coalesce(min2_DPF_bal,0) else  (case when min0.financial_year+2 = sub.financial_year then  coalesce(min1_DPF_bal,0) + coalesce(min2_DPF_bal,0) + coalesce(min3_DPF_bal,0) else  (case when min0.financial_year+3 = sub.financial_year then  coalesce(min1_DPF_bal,0) + coalesce(min2_DPF_bal,0) + coalesce(min3_DPF_bal,0) + coalesce(min4_DPF_bal,0) else  (case when min0.financial_year+4 = sub.financial_year then  coalesce(min1_DPF_bal,0) + coalesce(min2_DPF_bal,0) + coalesce(min3_DPF_bal,0) + coalesce(min4_DPF_bal,0) + coalesce(min5_DPF_bal,0) else  (case when min0.financial_year+5 = sub.financial_year then  coalesce(min1_DPF_bal,0) + coalesce(min2_DPF_bal,0) + coalesce(min3_DPF_bal,0) + coalesce(min4_DPF_bal,0) + coalesce(min5_DPF_bal,0) + coalesce(min6_DPF_bal,0)  else 0 end) end)  end) end) end) end closing_DPF_balance   from annual_submission sub    inner join organisation org on sub.organisation_id = org.id      left join ( select * from ( select distinct   org.id org_id,    min(cast(sub.financial_year as int) ) financial_year   from annual_submission sub   inner join organisation org on sub.organisation_id = org.id   group by org.id  ) a1  )min0 on org.id = min0.org_id     left join ( select * from ( select distinct   org.id org_id,  min.financial_year, sum(case when subb.grant_type = 'RCGF' and subc.type = 'Generated' then sube.value else 0 end) - sum(case when subb.grant_type = 'RCGF' and subc.type = 'Spent' then sube.value else 0 end)  min1_RCGF_bal ,    sum(case when subb.grant_type = 'DPF' and subc.type = 'Generated' then sube.value else 0 end) - sum(case when subb.grant_type = 'DPF' and subc.type = 'Spent' then sube.value else 0 end)  min1_DPF_bal      from annual_submission sub  inner join organisation org on sub.organisation_id = org.id  inner join annual_submission_block subb on sub.id = subb.annual_submission_id   inner join annual_submission_entry sube on subb.id = sube.block_id   inner join annual_submission_category subc on sube.category_id = subc.id    inner join ( select * from ( select distinct   org.id org_id,    min(cast(sub.financial_year as int) ) financial_year   from annual_submission sub   inner join organisation org on sub.organisation_id = org.id   group by org.id  ) a1  )min on org.id = min.org_id  and min.financial_year = sub.financial_year where subb.status_type = 'Actual' group by  org.id , min.financial_year  ) a  )min1 on org.id = min1.org_id      left join ( select * from ( select distinct   org.id org_id, sum(case when subb.grant_type = 'RCGF' and subc.type = 'Generated' then sube.value else 0 end) - sum(case when subb.grant_type = 'RCGF' and subc.type = 'Spent' then sube.value else 0 end)  min2_RCGF_bal ,    sum(case when subb.grant_type = 'DPF' and subc.type = 'Generated' then sube.value else 0 end) - sum(case when subb.grant_type = 'DPF' and subc.type = 'Spent' then sube.value else 0 end)  min2_DPF_bal      from annual_submission sub  inner join organisation org on sub.organisation_id = org.id  inner join annual_submission_block subb on sub.id = subb.annual_submission_id   inner join annual_submission_entry sube on subb.id = sube.block_id   inner join annual_submission_category subc on sube.category_id = subc.id    inner join ( select * from ( select distinct   org.id org_id,    min(cast(sub.financial_year as int) ) financial_year   from annual_submission sub   inner join organisation org on sub.organisation_id = org.id   group by org.id  ) a1  )min on org.id = min.org_id  and min.financial_year+1 = sub.financial_year where subb.status_type = 'Actual' group by  org.id   ) a  )min2 on org.id = min2.org_id     left join ( select * from ( select distinct   org.id org_id, sum(case when subb.grant_type = 'RCGF' and subc.type = 'Generated' then sube.value else 0 end) - sum(case when subb.grant_type = 'RCGF' and subc.type = 'Spent' then sube.value else 0 end)  min3_RCGF_bal,    sum(case when subb.grant_type = 'DPF' and subc.type = 'Generated' then sube.value else 0 end) - sum(case when subb.grant_type = 'DPF' and subc.type = 'Spent' then sube.value else 0 end)  min3_DPF_bal     from annual_submission sub  inner join organisation org on sub.organisation_id = org.id  inner join annual_submission_block subb on sub.id = subb.annual_submission_id   inner join annual_submission_entry sube on subb.id = sube.block_id   inner join annual_submission_category subc on sube.category_id = subc.id    inner join ( select * from ( select distinct   org.id org_id,    min(cast(sub.financial_year as int) ) financial_year   from annual_submission sub   inner join organisation org on sub.organisation_id = org.id   group by org.id  ) a1  )min on org.id = min.org_id  and min.financial_year+2 = sub.financial_year where subb.status_type = 'Actual' group by  org.id   ) a  )min3 on org.id = min3.org_id     left join ( select * from ( select distinct   org.id org_id, sum(case when subb.grant_type = 'RCGF' and subc.type = 'Generated' then sube.value else 0 end) - sum(case when subb.grant_type = 'RCGF' and subc.type = 'Spent' then sube.value else 0 end)  min4_RCGF_bal ,    sum(case when subb.grant_type = 'DPF' and subc.type = 'Generated' then sube.value else 0 end) - sum(case when subb.grant_type = 'DPF' and subc.type = 'Spent' then sube.value else 0 end)  min4_DPF_bal     from annual_submission sub  inner join organisation org on sub.organisation_id = org.id  inner join annual_submission_block subb on sub.id = subb.annual_submission_id   inner join annual_submission_entry sube on subb.id = sube.block_id   inner join annual_submission_category subc on sube.category_id = subc.id    inner join ( select * from ( select distinct   org.id org_id,    min(cast(sub.financial_year as int) ) financial_year   from annual_submission sub   inner join organisation org on sub.organisation_id = org.id   group by org.id  ) a1  )min on org.id = min.org_id  and min.financial_year+3 = sub.financial_year where subb.status_type = 'Actual' group by  org.id   ) a  )min4 on org.id = min4.org_id    left join ( select * from ( select distinct   org.id org_id, sum(case when subb.grant_type = 'RCGF' and subc.type = 'Generated' then sube.value else 0 end)  - sum(case when subb.grant_type = 'RCGF' and subc.type = 'Spent' then sube.value else 0 end)  min5_RCGF_bal,    sum(case when subb.grant_type = 'DPF' and subc.type = 'Generated' then sube.value else 0 end) - sum(case when subb.grant_type = 'DPF' and subc.type = 'Spent' then sube.value else 0 end)  min5_DPF_bal     from annual_submission sub  inner join organisation org on sub.organisation_id = org.id  inner join annual_submission_block subb on sub.id = subb.annual_submission_id   inner join annual_submission_entry sube on subb.id = sube.block_id   inner join annual_submission_category subc on sube.category_id = subc.id    inner join ( select * from ( select distinct   org.id org_id,    min(cast(sub.financial_year as int) ) financial_year   from annual_submission sub   inner join organisation org on sub.organisation_id = org.id   group by org.id  ) a1  )min on org.id = min.org_id  and min.financial_year+4 = sub.financial_year where subb.status_type = 'Actual' group by  org.id   ) a  )min5 on org.id = min5.org_id     left join ( select * from ( select distinct   org.id org_id, sum(case when subb.grant_type = 'RCGF' and subc.type = 'Generated' then sube.value else 0 end)  - sum(case when subb.grant_type = 'RCGF' and subc.type = 'Spent' then sube.value else 0 end)  min6_RCGF_bal ,    sum(case when subb.grant_type = 'DPF' and subc.type = 'Generated' then sube.value else 0 end) - sum(case when subb.grant_type = 'DPF' and subc.type = 'Spent' then sube.value else 0 end)  min6_DPF_bal     from annual_submission sub  inner join organisation org on sub.organisation_id = org.id  inner join annual_submission_block subb on sub.id = subb.annual_submission_id   inner join annual_submission_entry sube on subb.id = sube.block_id   inner join annual_submission_category subc on sube.category_id = subc.id    inner join ( select * from ( select distinct   org.id org_id,    min(cast(sub.financial_year as int) ) financial_year   from annual_submission sub   inner join organisation org on sub.organisation_id = org.id   group by org.id  ) a1  )min on org.id = min.org_id  and min.financial_year+5 = sub.financial_year where subb.status_type = 'Actual' group by  org.id   ) a  )min6 on org.id = min6.org_id