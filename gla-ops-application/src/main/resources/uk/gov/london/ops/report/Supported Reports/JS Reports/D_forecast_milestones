select distinct  pj.id project_id,  val.Financial_year, sum(CAP_Fcast)   CAP_Fcast, sum(CAP_Actual)  CAP_Actual, sum(CAP_Rem_Act) CAP_Rem_Act, sum(REV_Fcast)   REV_Fcast, sum(REV_Actual)  REV_Actual, sum(REV_Rem_Act) REV_Rem_Act   from project pj   inner join ( 	   select * from ( select distinct  pj.id project_id,   max(ts.id) id2,  max(ts.from_date) from_date,  max(ts.to_date) to_date,  max(ts.capital) capital,  max(ts.revenue) revenue      from project pj  left join project_block pjb on pj.id = pjb.project_id  left join project_budgets ts on pjb.id = ts.id where pjb.reporting_version = 'true' group by pj.id ) a  ) pj2 on pj.id = pj2.project_id    inner join ( 	   select * from (    select distinct  pb.project_id,  year calendar_year, year_month,month, case when month between '4' and '12' then cast(year as int) ||'/'|| cast(year+1 as int) else cast(year-1 as int) ||'/'|| cast(year as int)  end  Financial_year,  round(sum(case when ledger_status ='FORECAST'and spend_type ='CAPITAL' then (pl.amount*-1) else 0 end),0)   CAP_Fcast, round(sum(case when ledger_status ='ACTUAL'  and spend_type ='CAPITAL' then (pl.amount*-1) else 0 end),0)   CAP_Actual, round(sum(case when ledger_status ='ACTUAL'  and spend_type ='CAPITAL' then (pl.amount*-1) else 0 end)+       sum(case when ledger_status ='FORECAST'and spend_type ='CAPITAL' then (pl.amount*-1) else 0 end),0)   CAP_Rem_Act,  round(sum(case when ledger_status ='FORECAST'and spend_type ='REVENUE' then (pl.amount*-1) else 0 end),0)   REV_Fcast, round(sum(case when ledger_status ='ACTUAL'  and spend_type ='REVENUE' then (pl.amount*-1) else 0 end),0)   REV_Actual, round(sum(case when ledger_status ='ACTUAL'  and spend_type ='REVENUE' then (pl.amount*-1) else 0 end)+       sum(case when ledger_status ='FORECAST'and spend_type ='REVENUE' then (pl.amount*-1) else 0 end),0)   REV_Rem_Act      from project_block pb inner join project_ledger_entry pl on pb.project_id = pl.project_id and pb.id = pl.block_id  where pb.reporting_version = 'true' and (pl.category <> 'Finance use only' or  pl.category is null ) group by pb.project_id, year, year_month,month ) a   ) val on pj.id = val.project_id  GROUP BY  pj.id, val.Financial_year