select distinct   Pj.id project_id,  lar_units, llr_units, lso_units, oa_units, legacy_ar_units, legacy_aho_units, legacy_so_units,   profile_unit_lar, profile_unit_llr, profile_unit_lso, profile_unit_oa, profile_unit_legacy_ar, profile_unit_legacy_aho, profile_unit_legacy_so,   case when lar_units <> profile_unit_lar then 'N' else null end  profile_match_total_lar, case when llr_units <> profile_unit_llr then 'N' else null end  profile_match_total_llr, case when lso_units <> profile_unit_lso then 'N' else null end  profile_match_total_lso, case when oa_units  <> profile_unit_oa  then 'N' else null end  profile_match_total_oa,  case when legacy_ar_units  <> profile_unit_legacy_ar  then 'N' else null end profile_match_total_legacy_ar, case when legacy_aho_units <> profile_unit_legacy_aho then 'N' else null end profile_match_total_legacy_aho, case when legacy_so_units  <> profile_unit_legacy_so  then 'N' else null end profile_match_total_legacy_so,   profile_units  from project pj   left join ( select * from ( select distinct   pb.project_id, sum(u.nb_units) profile_units	,  sum(case when u.tenure_id ='4000' then coalesce(u.nb_units,0) else 0 end) profile_unit_lar,  sum(case when u.tenure_id ='4001' then coalesce(u.nb_units,0) else 0 end) profile_unit_llr,  sum(case when u.tenure_id ='4002' then coalesce(u.nb_units,0) else 0 end) profile_unit_lso,  sum(case when u.tenure_id ='4003' then coalesce(u.nb_units,0) else 0 end) profile_unit_oa, sum(case when u.tenure_id ='4004' then coalesce(u.nb_units,0) else 0 end) profile_unit_legacy_ar,  sum(case when u.tenure_id in ('4005') then coalesce(u.nb_units,0) else 0 end) profile_unit_legacy_aho, sum(case when u.tenure_id in ('4006') then coalesce(u.nb_units,0) else 0 end) profile_unit_legacy_so    from project_block pb inner join units_table_entry u on u.project_id = pb.project_id and u.block_id = pb.id left join tenure_type ty on u.tenure_id = ty.id  where  pb.block_display_name = 'Unit Details' and pb.reporting_version = 'true' and pb.block_status <> 'UNAPPROVED' group by pb.project_id )a )pf on pj.id = pf.project_id    left join ( select * from (       select distinct  pj.id project_id,   coalesce(cal_units1,0)+coalesce(neg_units1,0)+coalesce(dev_units1,0)+coalesce(inc_units1,0) lar_units, coalesce(cal_units2,0)+coalesce(neg_units2,0)+coalesce(dev_units2,0)+coalesce(inc_units2,0) llr_units, coalesce(cal_units3,0)+coalesce(neg_units3,0)+coalesce(dev_units3,0)+coalesce(inc_units3,0) lso_units, coalesce(cal_units4,0)+coalesce(neg_units4,0)+coalesce(dev_units4,0)+coalesce(inc_units4,0) oa_units, coalesce(cal_units5,0)+coalesce(neg_units5,0)+coalesce(dev_units5,0)+coalesce(inc_units5,0) legacy_ar_units, coalesce(cal_units6,0)+coalesce(neg_units6,0)+coalesce(dev_units6,0)+coalesce(inc_units6,0) legacy_aho_units, coalesce(cal_units7,0)+coalesce(neg_units7,0)+coalesce(dev_units7,0)+coalesce(inc_units7,0) legacy_so_units   from project pj   left join ( select * from ( select distinct  pb.project_id, pb.last_modified mod , sum(case when ty.external_id ='4000' then coalesce(ten.total_units,0) else 0 end) cal_units1,  sum(case when ty.external_id ='4001' then coalesce(ten.total_units,0) else 0 end) cal_units2,  sum(case when ty.external_id ='4002' then coalesce(ten.total_units,0) else 0 end) cal_units3,  sum(case when ty.external_id ='4003' then coalesce(ten.total_units,0) else 0 end) cal_units4, sum(case when ty.external_id ='4004' then coalesce(ten.total_units,0) else 0 end) cal_units5,  sum(case when ty.external_id in ('4005') then coalesce(ten.total_units,0) else 0 end) cal_units6, sum(case when ty.external_id in ('4006') then coalesce(ten.total_units,0) else 0 end) cal_units7,    sum(coalesce(ten.s106_units,0)) nil_grant_units      from project_block pb inner join project pj on pb.project_id = pj.id inner join tenure_and_units ten on pb.id = ten.block_id  inner join  template_tenure_type ty on ten.tenure_type_id = ty.id where  pb.block_display_name = 'Calculate Grant' and pb.reporting_version = 'true' and pb.block_status <> 'UNAPPROVED' group by pb.project_id, pb.last_modified ) a    )cal on pj.id = cal.project_id    left join ( select * from ( select distinct  pb.project_id, pb.last_modified mod , sum(case when ty.external_id ='4000' then coalesce(ten.total_units,0) else 0 end) neg_units1,  sum(case when ty.external_id ='4001' then coalesce(ten.total_units,0) else 0 end) neg_units2,  sum(case when ty.external_id ='4002' then coalesce(ten.total_units,0) else 0 end) neg_units3,  sum(case when ty.external_id ='4003' then coalesce(ten.total_units,0) else 0 end) neg_units4, sum(case when ty.external_id ='4004' then coalesce(ten.total_units,0) else 0 end) neg_units5,  sum(case when ty.external_id in ('4005') then coalesce(ten.total_units,0) else 0 end) neg_units6, sum(case when ty.external_id in ('4006') then coalesce(ten.total_units,0) else 0 end) neg_units7           from project_block pb inner join project pj on pb.project_id = pj.id inner join tenure_and_units ten on pb.id = ten.block_id  inner join  template_tenure_type ty on ten.tenure_type_id = ty.id where  pb.block_display_name = 'Negotiated Grant'and pb.reporting_version = 'true' and pb.block_status <> 'UNAPPROVED' group by pb.project_id, pb.last_modified  ) a  )neg on pj.id = neg.project_id    left join (   select * from ( select distinct  pb.project_id, pb.last_modified mod,    sum(case when ty.external_id ='4000' then coalesce(ten.s106_units,0)+ coalesce(ten.additional_units,0) else 0 end) dev_units1,  sum(case when ty.external_id ='4001' then coalesce(ten.s106_units,0)+ coalesce(ten.additional_units,0) else 0 end) dev_units2,  sum(case when ty.external_id ='4002' then coalesce(ten.s106_units,0)+ coalesce(ten.additional_units,0) else 0 end) dev_units3,  sum(case when ty.external_id ='4003' then coalesce(ten.s106_units,0)+ coalesce(ten.additional_units,0) else 0 end) dev_units4, sum(case when ty.external_id ='4004' then coalesce(ten.s106_units,0)+ coalesce(ten.additional_units,0) else 0 end) dev_units5,  sum(case when ty.external_id in ('4005') then coalesce(ten.s106_units,0)+ coalesce(ten.additional_units,0) else 0 end) dev_units6, sum(case when ty.external_id in ('4006') then coalesce(ten.s106_units,0)+ coalesce(ten.additional_units,0) else 0 end) dev_units7      from project_block pb inner join project pj on pb.project_id = pj.id inner join tenure_and_units ten on pb.id = ten.block_id  inner join  template_tenure_type ty on ten.tenure_type_id = ty.id where pb.block_display_name = 'Developer-led Grant' and pb.reporting_version = 'true' and pb.block_status <> 'UNAPPROVED' group by pb.project_id, pb.last_modified ) a  )dev on pj.id = dev.project_id    left join ( select * from ( select distinct  pb.project_id,  sum(inc.units) c_inc_units  ,    sum(case when ty.external_id ='4000' then coalesce(inc.units,0) else 0 end) inc_units1,  sum(case when ty.external_id ='4001' then coalesce(inc.units,0) else 0 end) inc_units2,  sum(case when ty.external_id ='4002' then coalesce(inc.units,0) else 0 end) inc_units3,  sum(case when ty.external_id ='4003' then coalesce(inc.units,0) else 0 end) inc_units4, sum(case when ty.external_id ='4004' then coalesce(inc.units,0) else 0 end) inc_units5,  sum(case when ty.external_id in ('4005') then coalesce(inc.units,0) else 0 end) inc_units6, sum(case when ty.external_id in ('4006') then coalesce(inc.units,0) else 0 end) inc_units7       from project_block pb   inner join tenure_and_units ten on pb.id = ten.block_id  inner join  template_tenure_type ty on ten.tenure_type_id = ty.id inner join indicative_tenure_value inc on ten.id = inc.tenure_units_id  where pb.block_display_name = 'Indicative Grant' and pb.reporting_version = 'true' and pb.block_status <> 'UNAPPROVED' group by pb.project_id ) a  )inc on pj.id = inc.project_id        )a )tot on pj.id = tot.project_id  where profile_units is not null